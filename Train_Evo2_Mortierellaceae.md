{
 "cells": [
  {
   "cell_type": "markdown",
   "id": "27e41e03-4ff3-4261-9163-f9a438ea209f",
   "metadata": {},
   "source": [
    "## Evo2 Finetuning with 96 Genomes from the Mortierellaceae"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 5,
   "id": "147a149d-b897-4dfe-9afc-16298e91469d",
   "metadata": {},
   "outputs": [],
   "source": [
    "import os\n",
    "\n",
    "concat_path = '/home/johnsh29/Evo2_Mortierellaceae/AllGenomes.fna'"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 6,
   "id": "9844a72d-b1df-4766-bfc5-919f84b83881",
   "metadata": {},
   "outputs": [],
   "source": [
    "full_fasta_path = os.path.abspath(concat_path)\n",
    "output_dir = os.path.abspath(\"preprocessed_data\")\n",
    "output_yaml = f\"\"\"\n",
    "- datapaths: [\"{full_fasta_path}\"]\n",
    "  output_dir: \"{output_dir}\"\n",
    "  output_prefix: Mortierellaceae_uint8_distinct\n",
    "  train_split: 0.9\n",
    "  valid_split: 0.05\n",
    "  test_split: 0.05\n",
    "  overwrite: True\n",
    "  embed_reverse_complement: true\n",
    "  random_reverse_complement: 0.0\n",
    "  random_lineage_dropout: 0.0\n",
    "  include_sequence_id: false\n",
    "  transcribe: \"back_transcribe\"\n",
    "  force_uppercase: True\n",
    "  indexed_dataset_dtype: \"uint8\"\n",
    "  tokenizer_type: \"Byte-Level\"\n",
    "  vocab_file: null\n",
    "  vocab_size: null\n",
    "  merges_file: null\n",
    "  pretrained_tokenizer_model: null\n",
    "  special_tokens: null\n",
    "  fast_hf_tokenizer: true\n",
    "  append_eod: true\n",
    "  enforce_sample_length: null\n",
    "  ftfy: false\n",
    "  workers: 1\n",
    "  preproc_concurrency: 100000\n",
    "  chunksize: 25\n",
    "  drop_empty_sequences: true\n",
    "  nnn_filter: false  # If you split your fasta on NNN (in human these are contigs), then you should set this to true.\n",
    "  seed: 12342  # Not relevant because we are not using random reverse complement or lineage dropout.\n",
    "\"\"\"\n",
    "with open(\"preprocess_config.yaml\", \"w\") as f:\n",
    "    print(output_yaml, file=f)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 7,
   "id": "ea0118ce-c7a2-467a-b5fd-7ad3c8a390b8",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "[NeMo I 2025-06-18 21:41:53 nemo_logging:393] Using byte-level tokenization\n",
      "[NeMo I 2025-06-18 21:41:53 nemo_logging:393] Created temporary binary datasets: /home/johnsh29/Evo2_Mortierellaceae/preprocessed_data/Mortierellaceae_uint8_distinct_byte-level_train.bin.tmp /home/johnsh29/Evo2_Mortierellaceae/preprocessed_data/Mortierellaceae_uint8_distinct_byte-level_val.bin.tmp /home/johnsh29/Evo2_Mortierellaceae/preprocessed_data/Mortierellaceae_uint8_distinct_byte-level_test.bin.tmp\n",
      "[NeMo I 2025-06-18 21:55:43 nemo_logging:393] Average preprocessing time per sequence: 0.0002956886035248247\n",
      "[NeMo I 2025-06-18 21:55:43 nemo_logging:393] Average indexing time per sequence: 0.0008919303745573302\n",
      "[NeMo I 2025-06-18 21:55:43 nemo_logging:393] Number of sequences processed: 538586\n",
      "[NeMo I 2025-06-18 21:55:46 nemo_logging:393] Finished preprocessing Mortierellaceae_uint8_distinct ([PosixPath('/home/johnsh29/Evo2_Mortierellaceae/AllGenomes.fna')]) in 832.294 seconds with 1 workers.\n"
     ]
    }
   ],
   "source": [
    "!preprocess_evo2 --config preprocess_config.yaml"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 8,
   "id": "bad5c142-965b-431a-8b0b-313ce46535aa",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "total 3.8G\n",
      "-rw-r--r-- 1 johnsh29 domain users 405M Jun 18 21:55 Mortierellaceae_uint8_distinct_byte-level_test.bin\n",
      "-rw-r--r-- 1 johnsh29 domain users 528K Jun 18 21:55 Mortierellaceae_uint8_distinct_byte-level_test.idx\n",
      "-rw-r--r-- 1 johnsh29 domain users 6.6G Jun 18 21:55 Mortierellaceae_uint8_distinct_byte-level_train.bin\n",
      "-rw-r--r-- 1 johnsh29 domain users 9.3M Jun 18 21:55 Mortierellaceae_uint8_distinct_byte-level_train.idx\n",
      "-rw-r--r-- 1 johnsh29 domain users 397M Jun 18 21:55 Mortierellaceae_uint8_distinct_byte-level_val.bin\n",
      "-rw-r--r-- 1 johnsh29 domain users 520K Jun 18 21:55 Mortierellaceae_uint8_distinct_byte-level_val.idx\n"
     ]
    }
   ],
   "source": [
    "!ls -lh preprocessed_data/"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 9,
   "id": "333d2273-5e1d-4872-b99d-be04f2da6e42",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Could not find the bitsandbytes CUDA binary at PosixPath('/usr/local/lib/python3.12/dist-packages/bitsandbytes/libbitsandbytes_cuda129.so')\n",
      "The installed version of bitsandbytes was compiled without GPU support. 8-bit optimizers, 8-bit multiplication, and GPU quantization are unavailable.\n",
      "[NeMo I 2025-06-18 21:56:00 nemo_logging:393] Using byte-level tokenization\n",
      "GPU available: True (cuda), used: False\n",
      "TPU available: False, using: 0 TPU cores\n",
      "HPU available: False, using: 0 HPUs\n",
      "[NeMo W 2025-06-18 21:56:00 nemo_logging:405] /usr/local/lib/python3.12/dist-packages/lightning/pytorch/trainer/setup.py:177: GPU available but not used. You can set it by doing `Trainer(accelerator='gpu')`.\n",
      "    \n",
      "[NeMo I 2025-06-18 21:56:00 nemo_logging:393] Fixing mis-match between ddp-config & mcore-optimizer config\n",
      "[NeMo I 2025-06-18 21:56:00 nemo_logging:393] Rank 0 has data parallel group : [0]\n",
      "[NeMo I 2025-06-18 21:56:00 nemo_logging:393] Rank 0 has combined group of data parallel and context parallel : [0]\n",
      "[NeMo I 2025-06-18 21:56:00 nemo_logging:393] All data parallel group ranks with context parallel combined: [[0]]\n",
      "[NeMo I 2025-06-18 21:56:00 nemo_logging:393] Ranks 0 has data parallel rank: 0\n",
      "[NeMo I 2025-06-18 21:56:00 nemo_logging:393] Rank 0 has context parallel group: [0]\n",
      "[NeMo I 2025-06-18 21:56:00 nemo_logging:393] All context parallel group ranks: [[0]]\n",
      "[NeMo I 2025-06-18 21:56:00 nemo_logging:393] Ranks 0 has context parallel rank: 0\n",
      "[NeMo I 2025-06-18 21:56:00 nemo_logging:393] Rank 0 has model parallel group: [0]\n",
      "[NeMo I 2025-06-18 21:56:00 nemo_logging:393] All model parallel group ranks: [[0]]\n",
      "[NeMo I 2025-06-18 21:56:00 nemo_logging:393] Rank 0 has tensor model parallel group: [0]\n",
      "[NeMo I 2025-06-18 21:56:00 nemo_logging:393] All tensor model parallel group ranks: [[0]]\n",
      "[NeMo I 2025-06-18 21:56:00 nemo_logging:393] Rank 0 has tensor model parallel rank: 0\n",
      "[NeMo I 2025-06-18 21:56:00 nemo_logging:393] Rank 0 has pipeline model parallel group: [0]\n",
      "[NeMo I 2025-06-18 21:56:00 nemo_logging:393] Rank 0 has embedding group: [0]\n",
      "[NeMo I 2025-06-18 21:56:00 nemo_logging:393] All pipeline model parallel group ranks: [[0]]\n",
      "[NeMo I 2025-06-18 21:56:00 nemo_logging:393] Rank 0 has pipeline model parallel rank 0\n",
      "[NeMo I 2025-06-18 21:56:00 nemo_logging:393] All embedding group ranks: [[0]]\n",
      "[NeMo I 2025-06-18 21:56:00 nemo_logging:393] Rank 0 has embedding rank: 0\n",
      "----------------------------------------------------------------------------------------------------\n",
      "distributed_backend=gloo\n",
      "All distributed processes registered. Starting with 1 processes\n",
      "----------------------------------------------------------------------------------------------------\n",
      "\n",
      "[NeMo W 2025-06-18 21:56:00 nemo_logging:405] /usr/local/lib/python3.12/dist-packages/lightning/pytorch/trainer/trainer.py:1090: `trainer.init_module` cannot fully support proper instantiation of your model with the `MegatronStrategy` strategy. Please instantiate your model inside the`LightningModule.configure_model` hook instead\n",
      "    \n",
      "[NeMo I 2025-06-18 21:56:00 nemo_logging:393] Padded vocab_size: 512, original vocab_size: 512, dummy tokens: 0.\n",
      "CPU RNG state changed within GPU RNG context\n",
      "CPU RNG state changed within GPU RNG context\n",
      "CPU RNG state changed within GPU RNG context\n",
      "CPU RNG state changed within GPU RNG context\n",
      "CPU RNG state changed within GPU RNG context\n",
      "CPU RNG state changed within GPU RNG context\n",
      "CPU RNG state changed within GPU RNG context\n",
      "CPU RNG state changed within GPU RNG context\n",
      "CPU RNG state changed within GPU RNG context\n",
      "CPU RNG state changed within GPU RNG context\n",
      "CPU RNG state changed within GPU RNG context\n",
      "CPU RNG state changed within GPU RNG context\n",
      "CPU RNG state changed within GPU RNG context\n",
      "CPU RNG state changed within GPU RNG context\n",
      "[NeMo W 2025-06-18 21:56:02 nemo_logging:405] Could not copy Trainer's 'max_steps' to LR scheduler's 'max_steps'. If you are not using an LR scheduler, this warning can safely be ignored.\n",
      "[NeMo I 2025-06-18 21:56:02 nemo_logging:393] Using FullyParallelSaveStrategyWrapper(torch_dist, 1) dist-ckpt save strategy.\n",
      "[NeMo I 2025-06-18 21:56:22 nemo_logging:393] Global Checkpoint Save : Rank: 0 : Iteration: 0 : Start time: 1750308962.206s : Save duration: 20.774s\n",
      "[NeMo I 2025-06-18 21:56:23 nemo_logging:393] Converted Hyena model to Nemo, model saved to nemo2_evo2_1b_8k\n"
     ]
    }
   ],
   "source": [
    "!evo2_convert_to_nemo2 \\\n",
    "  --model-path hf://arcinstitute/savanna_evo2_1b_base \\\n",
    "  --model-size 1b --output-dir nemo2_evo2_1b_8k"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 10,
   "id": "1261975f-7536-4332-a13b-f333f664c8b5",
   "metadata": {},
   "outputs": [],
   "source": [
    "import os\n",
    "from pathlib import Path\n",
    "output_pfx = str(Path(os.path.abspath(\"preprocessed_data\"))/\"Mortierellaceae_uint8_distinct_byte-level\")\n",
    "output_yaml = f\"\"\"\n",
    "- dataset_prefix: {output_pfx}_train\n",
    "  dataset_split: train\n",
    "  dataset_weight: 1.0\n",
    "- dataset_prefix: {output_pfx}_val\n",
    "  dataset_split: validation\n",
    "  dataset_weight: 1.0\n",
    "- dataset_prefix: {output_pfx}_test\n",
    "  dataset_split: test\n",
    "  dataset_weight: 1.0\n",
    "\"\"\"\n",
    "with open(\"training_data_config.yaml\", \"w\") as f:\n",
    "    print(output_yaml, file=f)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 11,
   "id": "7b4cd39c-1880-4991-9a35-5024984350ec",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Number of Steps for One Full Pass of the Data:  26610\n"
     ]
    }
   ],
   "source": [
    "## Estimate number of steps\n",
    "\n",
    "TotalBasePairs = 3875446222\n",
    "TotalTrainingBasePairs = TotalBasePairs * 0.9  # 90% of total base pairs\n",
    "GlobalBatchSize = 16 # microbatch of 2 times 8 GPUs\n",
    "ContextLength = 8192\n",
    "\n",
    "BasePairsPerBatch = ContextLength * GlobalBatchSize\n",
    "\n",
    "StepsPerEpoch = TotalTrainingBasePairs / BasePairsPerBatch\n",
    "\n",
    "print(\"Number of Steps for One Full Pass of the Data: \", int(StepsPerEpoch))"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 12,
   "id": "c47e1554-8e9c-4b11-82af-1ae0f3f7bf49",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Could not find the bitsandbytes CUDA binary at PosixPath('/usr/local/lib/python3.12/dist-packages/bitsandbytes/libbitsandbytes_cuda129.so')\n",
      "The installed version of bitsandbytes was compiled without GPU support. 8-bit optimizers, 8-bit multiplication, and GPU quantization are unavailable.\n",
      "[NeMo I 2025-06-18 21:56:36 nemo_logging:393] Using byte-level tokenization\n",
      "[NeMo W 2025-06-18 21:56:36 nemo_logging:405] WandB is currently turned off.\n",
      "[NeMo W 2025-06-18 21:56:36 nemo_logging:405] User-set tensorboard is currently turned off. Internally one may still be set by NeMo2.\n",
      "Trainer already configured with model summary callbacks: [<class 'lightning.pytorch.callbacks.rich_model_summary.RichModelSummary'>]. Skipping setting a default `ModelSummary` callback.\n",
      "GPU available: True (cuda), used: True\n",
      "TPU available: False, using: 0 TPU cores\n",
      "HPU available: False, using: 0 HPUs\n",
      "[NeMo I 2025-06-18 21:56:36 nemo_logging:393] Experiments will be logged at pretraining_mortierellaceae/evo2/dev\n",
      "[NeMo W 2025-06-18 21:56:36 nemo_logging:405] There were no checkpoints found in checkpoint_dir or no checkpoint folder at checkpoint_dir :pretraining_mortierellaceae/evo2/checkpoints. Training from scratch.\n",
      "[NeMo I 2025-06-18 21:56:36 nemo_logging:393] Fixing mis-match between ddp-config & mcore-optimizer config\n",
      "[NeMo I 2025-06-18 21:56:36 nemo_logging:393] Rank 0 has data parallel group : [0]\n",
      "[NeMo I 2025-06-18 21:56:36 nemo_logging:393] Rank 0 has combined group of data parallel and context parallel : [0]\n",
      "[NeMo I 2025-06-18 21:56:36 nemo_logging:393] All data parallel group ranks with context parallel combined: [[0]]\n",
      "[NeMo I 2025-06-18 21:56:36 nemo_logging:393] Ranks 0 has data parallel rank: 0\n",
      "[NeMo I 2025-06-18 21:56:36 nemo_logging:393] Rank 0 has context parallel group: [0]\n",
      "[NeMo I 2025-06-18 21:56:36 nemo_logging:393] All context parallel group ranks: [[0]]\n",
      "[NeMo I 2025-06-18 21:56:36 nemo_logging:393] Ranks 0 has context parallel rank: 0\n",
      "[NeMo I 2025-06-18 21:56:36 nemo_logging:393] Rank 0 has model parallel group: [0]\n",
      "[NeMo I 2025-06-18 21:56:36 nemo_logging:393] All model parallel group ranks: [[0]]\n",
      "[NeMo I 2025-06-18 21:56:36 nemo_logging:393] Rank 0 has tensor model parallel group: [0]\n",
      "[NeMo I 2025-06-18 21:56:36 nemo_logging:393] All tensor model parallel group ranks: [[0]]\n",
      "[NeMo I 2025-06-18 21:56:36 nemo_logging:393] Rank 0 has tensor model parallel rank: 0\n",
      "[NeMo I 2025-06-18 21:56:36 nemo_logging:393] Rank 0 has pipeline model parallel group: [0]\n",
      "[NeMo I 2025-06-18 21:56:36 nemo_logging:393] Rank 0 has embedding group: [0]\n",
      "[NeMo I 2025-06-18 21:56:36 nemo_logging:393] All pipeline model parallel group ranks: [[0]]\n",
      "[NeMo I 2025-06-18 21:56:36 nemo_logging:393] Rank 0 has pipeline model parallel rank 0\n",
      "[NeMo I 2025-06-18 21:56:36 nemo_logging:393] All embedding group ranks: [[0]]\n",
      "[NeMo I 2025-06-18 21:56:36 nemo_logging:393] Rank 0 has embedding rank: 0\n",
      "----------------------------------------------------------------------------------------------------\n",
      "distributed_backend=nccl\n",
      "All distributed processes registered. Starting with 1 processes\n",
      "----------------------------------------------------------------------------------------------------\n",
      "\n",
      "[NeMo I 2025-06-18 21:56:37 utils:554] Building Evo2Dataset splits with sizes=[10, 60, 1] and config=GPTDatasetConfig(random_seed=1234, sequence_length=8192, blend=None, blend_per_split=[(['/home/johnsh29/Evo2_Mortierellaceae/preprocessed_data/Mortierellaceae_uint8_distinct_byte-level_train'], [1.0]), (['/home/johnsh29/Evo2_Mortierellaceae/preprocessed_data/Mortierellaceae_uint8_distinct_byte-level_val'], [1.0]), (['/home/johnsh29/Evo2_Mortierellaceae/preprocessed_data/Mortierellaceae_uint8_distinct_byte-level_test'], [1.0])], split=None, split_matrix=None, num_dataset_builder_threads=1, path_to_cache=None, mmap_bin_files=True, mock=False, tokenizer=<nemo.collections.common.tokenizers.bytelevel_tokenizers.ByteLevelTokenizer object at 0x7f1efa5c0830>, mid_level_dataset_surplus=0.005, reset_position_ids=False, reset_attention_mask=False, eod_mask_loss=False, create_attention_mask=False, drop_last_partial_validation_sequence=True, add_extra_token_to_sequence=True, object_storage_cache_path=None)\n",
      "[NeMo I 2025-06-18 21:56:37 utils:554] Load the _IndexReader from /home/johnsh29/Evo2_Mortierellaceae/preprocessed_data/Mortierellaceae_uint8_distinct_byte-level_train.idx\n",
      "[NeMo I 2025-06-18 21:56:38 utils:554] \tExtract the sequence lengths\n",
      "[NeMo I 2025-06-18 21:56:38 utils:554] \tExtract the sequence pointers\n",
      "[NeMo I 2025-06-18 21:56:38 utils:554] \tExtract the document indices\n",
      "[NeMo I 2025-06-18 21:56:38 utils:554] > total number of sequences: 484998\n",
      "[NeMo I 2025-06-18 21:56:38 utils:554] > total number of documents: 484998\n",
      "[NeMo I 2025-06-18 21:56:38 utils:554] Build and save the Evo2Dataset train indices\n",
      "[NeMo I 2025-06-18 21:56:38 utils:554] > total number of samples: 863395\n",
      "[NeMo I 2025-06-18 21:56:38 utils:554] > total number of epochs: 1\n",
      "[NeMo I 2025-06-18 21:56:38 utils:554] Load the _IndexReader from /home/johnsh29/Evo2_Mortierellaceae/preprocessed_data/Mortierellaceae_uint8_distinct_byte-level_val.idx\n",
      "[NeMo I 2025-06-18 21:56:38 utils:554] \tExtract the sequence lengths\n",
      "[NeMo I 2025-06-18 21:56:38 utils:554] \tExtract the sequence pointers\n",
      "[NeMo I 2025-06-18 21:56:38 utils:554] \tExtract the document indices\n",
      "[NeMo I 2025-06-18 21:56:38 utils:554] > total number of sequences: 26594\n",
      "[NeMo I 2025-06-18 21:56:38 utils:554] > total number of documents: 26594\n",
      "[NeMo I 2025-06-18 21:56:38 utils:554] Build and save the Evo2Dataset valid indices\n",
      "[NeMo I 2025-06-18 21:56:38 utils:554] > total number of samples: 50710\n",
      "[NeMo I 2025-06-18 21:56:38 utils:554] > total number of epochs: 1\n",
      "[NeMo I 2025-06-18 21:56:38 utils:554] Load the _IndexReader from /home/johnsh29/Evo2_Mortierellaceae/preprocessed_data/Mortierellaceae_uint8_distinct_byte-level_test.idx\n",
      "[NeMo I 2025-06-18 21:56:38 utils:554] \tExtract the sequence lengths\n",
      "[NeMo I 2025-06-18 21:56:38 utils:554] \tExtract the sequence pointers\n",
      "[NeMo I 2025-06-18 21:56:38 utils:554] \tExtract the document indices\n",
      "[NeMo I 2025-06-18 21:56:38 utils:554] > total number of sequences: 26994\n",
      "[NeMo I 2025-06-18 21:56:38 utils:554] > total number of documents: 26994\n",
      "[NeMo I 2025-06-18 21:56:38 utils:554] Build and save the Evo2Dataset test indices\n",
      "[NeMo I 2025-06-18 21:56:38 utils:554] > total number of samples: 51815\n",
      "[NeMo I 2025-06-18 21:56:38 utils:554] > total number of epochs: 1\n",
      "[NeMo I 2025-06-18 21:56:38 nemo_logging:393] Padded vocab_size: 512, original vocab_size: 512, dummy tokens: 0.\n",
      "[NeMo W 2025-06-18 21:56:38 random:222] CPU RNG state changed within GPU RNG context\n",
      "[NeMo W 2025-06-18 21:56:38 random:222] CPU RNG state changed within GPU RNG context\n",
      "[NeMo W 2025-06-18 21:56:38 random:222] CPU RNG state changed within GPU RNG context\n",
      "[NeMo W 2025-06-18 21:56:38 random:222] CPU RNG state changed within GPU RNG context\n",
      "[NeMo W 2025-06-18 21:56:38 random:222] CPU RNG state changed within GPU RNG context\n",
      "[NeMo W 2025-06-18 21:56:38 random:222] CPU RNG state changed within GPU RNG context\n",
      "[NeMo W 2025-06-18 21:56:38 random:222] CPU RNG state changed within GPU RNG context\n",
      "[NeMo W 2025-06-18 21:56:38 random:222] CPU RNG state changed within GPU RNG context\n",
      "[NeMo W 2025-06-18 21:56:38 random:222] CPU RNG state changed within GPU RNG context\n",
      "[NeMo W 2025-06-18 21:56:38 random:222] CPU RNG state changed within GPU RNG context\n",
      "[NeMo W 2025-06-18 21:56:38 random:222] CPU RNG state changed within GPU RNG context\n",
      "[NeMo W 2025-06-18 21:56:38 random:222] CPU RNG state changed within GPU RNG context\n",
      "[NeMo W 2025-06-18 21:56:38 random:222] CPU RNG state changed within GPU RNG context\n",
      "[NeMo W 2025-06-18 21:56:38 random:222] CPU RNG state changed within GPU RNG context\n",
      "LOCAL_RANK: 0 - CUDA_VISIBLE_DEVICES: [0,1,2,3]\n",
      "[NeMo I 2025-06-18 21:56:38 nemo_logging:393] Copying Trainer's 'max_steps' (10) to LR scheduler's 'max_steps'.\n",
      "[NeMo I 2025-06-18 21:56:38 num_microbatches_calculator:228] setting number of microbatches to constant 1\n",
      "[NeMo I 2025-06-18 21:56:38 nemo_logging:393]  > number of parameters on (tensor, pipeline) model parallel rank (0 ,0): 1108204800\n",
      "[NeMo I 2025-06-18 21:56:38 utils:554] Setting up DistributedDataParallel with config DistributedDataParallelConfig(grad_reduce_in_fp32=False, overlap_grad_reduce=False, overlap_param_gather=False, align_param_gather=False, use_distributed_optimizer=True, num_distributed_optimizer_instances=1, check_for_nan_in_grad=True, check_for_large_grads=False, bucket_size=None, pad_buckets_for_high_nccl_busbw=False, average_in_collective=True, fp8_param_gather=False, use_custom_fsdp=False, data_parallel_sharding_strategy='no_shard', gradient_reduce_div_fusion=True, suggested_communication_unit_size=None, preserve_fp32_weights=True, keep_fp8_transpose_cache_when_using_custom_fsdp=False)\n",
      "[NeMo I 2025-06-18 21:56:38 utils:575] Number of buckets for gradient all-reduce / reduce-scatter: 1\n",
      "    Params for bucket 1 (1108204800 elements, 1108204800 padded size):\n",
      "    \tmodule.decoder.layers.21.mixer.dense.weight\n",
      "    \tmodule.decoder.layers.15.mlp.linear_fc2.weight\n",
      "    \tmodule.decoder.layers.11.mlp.linear_fc1.layer_norm_weight\n",
      "    \tmodule.decoder.layers.8.mlp.linear_fc2.weight\n",
      "    \tmodule.decoder.layers.4.mlp.linear_fc1.layer_norm_weight\n",
      "    \tmodule.decoder.layers.1.mixer.dense_projection.weight\n",
      "    \tmodule.decoder.layers.20.mixer.dense_projection.weight\n",
      "    \tmodule.decoder.layers.9.mixer.dense.weight\n",
      "    \tmodule.decoder.layers.2.mixer.dense.weight\n",
      "    \tmodule.decoder.layers.23.mixer.mixer.filter.R\n",
      "    \tmodule.decoder.layers.20.mlp.linear_fc2.weight\n",
      "    \tmodule.decoder.layers.18.mlp.linear_fc1.weight\n",
      "    \tmodule.decoder.layers.10.mlp.linear_fc1.weight\n",
      "    \tmodule.decoder.layers.3.mlp.linear_fc1.weight\n",
      "    \tmodule.decoder.layers.1.mixer.mixer.filter.h\n",
      "    \tmodule.embedding.word_embeddings.weight\n",
      "    \tmodule.decoder.layers.22.mixer.dense_projection.layer_norm_weight\n",
      "    \tmodule.decoder.layers.21.mixer.dense.bias\n",
      "    \tmodule.decoder.layers.14.mixer.dense_projection.layer_norm_weight\n",
      "    \tmodule.decoder.layers.12.mixer.dense.bias\n",
      "    \tmodule.decoder.layers.11.mlp.linear_fc2.weight\n",
      "    \tmodule.decoder.layers.7.mixer.dense_projection.layer_norm_weight\n",
      "    \tmodule.decoder.layers.4.mlp.linear_fc2.weight\n",
      "    \tmodule.decoder.layers.1.mixer.dense.weight\n",
      "    \tmodule.decoder.layers.22.mlp.linear_fc2.weight\n",
      "    \tmodule.decoder.layers.18.mlp.linear_fc1.layer_norm_weight\n",
      "    \tmodule.decoder.layers.12.mlp.linear_fc1.weight\n",
      "    \tmodule.decoder.layers.5.mlp.linear_fc1.weight\n",
      "    \tmodule.decoder.layers.1.mlp.linear_fc1.weight\n",
      "    \tmodule.decoder.layers.0.mixer.dense.bias\n",
      "    \tmodule.decoder.layers.0.mixer.dense_projection.weight\n",
      "    \tmodule.decoder.layers.23.mixer.dense.weight\n",
      "    \tmodule.decoder.layers.16.mlp.linear_fc1.layer_norm_weight\n",
      "    \tmodule.decoder.layers.16.mixer.dense_projection.layer_norm_weight\n",
      "    \tmodule.decoder.layers.15.mixer.mixer.conv_bias\n",
      "    \tmodule.decoder.layers.11.mixer.dense.weight\n",
      "    \tmodule.decoder.layers.9.mixer.dense_projection.layer_norm_weight\n",
      "    \tmodule.decoder.layers.8.mixer.mixer.conv_bias\n",
      "    \tmodule.decoder.layers.4.mixer.dense.weight\n",
      "    \tmodule.decoder.layers.2.mixer.mixer.conv_bias\n",
      "    \tmodule.decoder.layers.24.mlp.linear_fc1.weight\n",
      "    \tmodule.decoder.layers.17.mlp.linear_fc1.weight\n",
      "    \tmodule.decoder.layers.9.mlp.linear_fc1.layer_norm_weight\n",
      "    \tmodule.decoder.layers.2.mlp.linear_fc1.layer_norm_weight\n",
      "    \tmodule.decoder.layers.21.mixer.dense_projection.layer_norm_weight\n",
      "    \tmodule.decoder.layers.18.mlp.linear_fc2.weight\n",
      "    \tmodule.decoder.layers.13.mixer.mixer.filter.R\n",
      "    \tmodule.decoder.layers.11.mixer.dense.bias\n",
      "    \tmodule.decoder.layers.10.mlp.linear_fc2.weight\n",
      "    \tmodule.decoder.layers.6.mixer.mixer.filter.R\n",
      "    \tmodule.decoder.layers.3.mlp.linear_fc2.weight\n",
      "    \tmodule.decoder.layers.0.mlp.linear_fc1.weight\n",
      "    \tmodule.decoder.layers.19.mlp.linear_fc1.weight\n",
      "    \tmodule.decoder.layers.14.mixer.mixer.short_conv.short_conv_weight\n",
      "    \tmodule.decoder.layers.12.mixer.dense_projection.layer_norm_weight\n",
      "    \tmodule.decoder.layers.7.mixer.mixer.short_conv.short_conv_weight\n",
      "    \tmodule.decoder.layers.5.mixer.dense_projection.layer_norm_weight\n",
      "    \tmodule.decoder.layers.23.mixer.dense_projection.layer_norm_weight\n",
      "    \tmodule.decoder.layers.22.mixer.mixer.conv_bias\n",
      "    \tmodule.decoder.layers.18.mixer.dense.weight\n",
      "    \tmodule.decoder.layers.15.mixer.hyena_proj_conv.short_conv_weight\n",
      "    \tmodule.decoder.layers.12.mlp.linear_fc2.weight\n",
      "    \tmodule.decoder.layers.12.mixer.mixer.conv_bias\n",
      "    \tmodule.decoder.layers.8.mixer.hyena_proj_conv.short_conv_weight\n",
      "    \tmodule.decoder.layers.5.mlp.linear_fc2.weight\n",
      "    \tmodule.decoder.layers.4.mixer.dense.bias\n",
      "    \tmodule.decoder.layers.0.mixer.mixer.short_conv.short_conv_weight\n",
      "    \tmodule.decoder.layers.23.mlp.linear_fc1.layer_norm_weight\n",
      "    \tmodule.decoder.layers.16.mixer.mixer.filter.gamma\n",
      "    \tmodule.decoder.layers.13.mixer.dense.weight\n",
      "    \tmodule.decoder.layers.10.self_attention.linear_proj.bias\n",
      "    \tmodule.decoder.layers.9.mixer.mixer.filter.gamma\n",
      "    \tmodule.decoder.layers.6.mixer.dense.weight\n",
      "    \tmodule.decoder.layers.2.mixer.dense_projection.layer_norm_weight\n",
      "    \tmodule.decoder.final_norm.weight\n",
      "    \tmodule.decoder.layers.24.mlp.linear_fc2.weight\n",
      "    \tmodule.decoder.layers.20.mixer.mixer.filter.R\n",
      "    \tmodule.decoder.layers.17.mlp.linear_fc2.weight\n",
      "    \tmodule.decoder.layers.15.mixer.mixer.filter.h\n",
      "    \tmodule.decoder.layers.10.self_attention.linear_proj.weight\n",
      "    \tmodule.decoder.layers.8.mixer.mixer.filter.h\n",
      "    \tmodule.decoder.layers.5.mixer.dense.bias\n",
      "    \tmodule.decoder.layers.3.self_attention.linear_proj.weight\n",
      "    \tmodule.decoder.layers.21.mixer.mixer.short_conv.short_conv_weight\n",
      "    \tmodule.decoder.layers.19.mixer.dense_projection.layer_norm_weight\n",
      "    \tmodule.decoder.layers.15.mixer.dense.bias\n",
      "    \tmodule.decoder.layers.15.mixer.dense.weight\n",
      "    \tmodule.decoder.layers.11.mixer.dense_projection.layer_norm_weight\n",
      "    \tmodule.decoder.layers.8.mixer.dense.bias\n",
      "    \tmodule.decoder.layers.8.mixer.dense.weight\n",
      "    \tmodule.decoder.layers.4.mixer.dense_projection.layer_norm_weight\n",
      "    \tmodule.decoder.layers.0.mlp.linear_fc2.weight\n",
      "    \tmodule.decoder.layers.22.mixer.hyena_proj_conv.short_conv_weight\n",
      "    \tmodule.decoder.layers.19.mlp.linear_fc2.weight\n",
      "    \tmodule.decoder.layers.16.mixer.mixer.filter.p\n",
      "    \tmodule.decoder.layers.14.mixer.hyena_proj_conv.short_conv_weight\n",
      "    \tmodule.decoder.layers.9.mixer.mixer.filter.p\n",
      "    \tmodule.decoder.layers.7.mixer.hyena_proj_conv.short_conv_weight\n",
      "    \tmodule.decoder.layers.5.mixer.mixer.conv_bias\n",
      "    \tmodule.decoder.layers.2.mixer.mixer.filter.p\n",
      "    \tmodule.decoder.layers.2.mixer.dense_projection.weight\n",
      "    \tmodule.decoder.layers.23.mixer.mixer.filter.gamma\n",
      "    \tmodule.decoder.layers.20.mixer.dense.weight\n",
      "    \tmodule.decoder.layers.15.mixer.dense_projection.weight\n",
      "    \tmodule.decoder.layers.13.mixer.dense_projection.layer_norm_weight\n",
      "    \tmodule.decoder.layers.8.mixer.dense_projection.weight\n",
      "    \tmodule.decoder.layers.6.mixer.dense_projection.layer_norm_weight\n",
      "    \tmodule.decoder.layers.0.mixer.dense.weight\n",
      "    \tmodule.decoder.layers.17.self_attention.linear_proj.weight\n",
      "    \tmodule.decoder.layers.24.self_attention.linear_proj.weight\n",
      "    \tmodule.decoder.layers.22.mixer.mixer.filter.h\n",
      "    \tmodule.decoder.layers.19.mixer.dense.bias\n",
      "    \tmodule.decoder.layers.16.mixer.hyena_proj_conv.short_conv_weight\n",
      "    \tmodule.decoder.layers.13.mlp.linear_fc1.layer_norm_weight\n",
      "    \tmodule.decoder.layers.9.mixer.hyena_proj_conv.short_conv_weight\n",
      "    \tmodule.decoder.layers.6.mlp.linear_fc1.layer_norm_weight\n",
      "    \tmodule.decoder.layers.3.self_attention.linear_proj.bias\n",
      "    \tmodule.decoder.layers.22.mixer.dense.bias\n",
      "    \tmodule.decoder.layers.22.mixer.dense.weight\n",
      "    \tmodule.decoder.layers.18.mixer.dense_projection.layer_norm_weight\n",
      "    \tmodule.decoder.layers.14.mixer.dense.bias\n",
      "    \tmodule.decoder.layers.9.mlp.linear_fc1.weight\n",
      "    \tmodule.decoder.layers.6.mixer.mixer.conv_bias\n",
      "    \tmodule.decoder.layers.2.mlp.linear_fc1.weight\n",
      "    \tmodule.decoder.layers.0.mixer.dense_projection.layer_norm_weight\n",
      "    \tmodule.decoder.layers.23.mixer.mixer.filter.p\n",
      "    \tmodule.decoder.layers.21.mixer.hyena_proj_conv.short_conv_weight\n",
      "    \tmodule.decoder.layers.19.mixer.mixer.conv_bias\n",
      "    \tmodule.decoder.layers.15.mlp.linear_fc1.layer_norm_weight\n",
      "    \tmodule.decoder.layers.11.mixer.mixer.short_conv.short_conv_weight\n",
      "    \tmodule.decoder.layers.8.mlp.linear_fc1.layer_norm_weight\n",
      "    \tmodule.decoder.layers.4.mixer.mixer.short_conv.short_conv_weight\n",
      "    \tmodule.decoder.layers.1.mixer.dense_projection.layer_norm_weight\n",
      "    \tmodule.decoder.layers.22.mixer.dense_projection.weight\n",
      "    \tmodule.decoder.layers.20.mixer.dense_projection.layer_norm_weight\n",
      "    \tmodule.decoder.layers.18.mixer.dense.bias\n",
      "    \tmodule.decoder.layers.16.mixer.dense.weight\n",
      "    \tmodule.decoder.layers.14.mixer.dense_projection.weight\n",
      "    \tmodule.decoder.layers.12.mixer.hyena_proj_conv.short_conv_weight\n",
      "    \tmodule.decoder.layers.9.mixer.dense.bias\n",
      "    \tmodule.decoder.layers.7.mixer.dense_projection.weight\n",
      "    \tmodule.decoder.layers.5.mixer.hyena_proj_conv.short_conv_weight\n",
      "    \tmodule.decoder.layers.2.mixer.dense.bias\n",
      "    \tmodule.decoder.layers.23.mixer.hyena_proj_conv.short_conv_weight\n",
      "    \tmodule.decoder.layers.20.mlp.linear_fc1.layer_norm_weight\n",
      "    \tmodule.decoder.layers.13.mixer.mixer.filter.gamma\n",
      "    \tmodule.decoder.layers.10.self_attention.linear_qkv.weight\n",
      "    \tmodule.decoder.layers.6.mixer.mixer.filter.gamma\n",
      "    \tmodule.decoder.layers.3.self_attention.linear_qkv.weight\n",
      "    \tmodule.decoder.layers.1.mixer.dense.bias\n",
      "    \tmodule.decoder.layers.23.mlp.linear_fc1.weight\n",
      "    \tmodule.decoder.layers.20.mixer.mixer.conv_bias\n",
      "    \tmodule.decoder.layers.16.mlp.linear_fc1.weight\n",
      "    \tmodule.decoder.layers.16.mixer.dense_projection.weight\n",
      "    \tmodule.decoder.layers.12.mixer.mixer.filter.h\n",
      "    \tmodule.decoder.layers.9.mixer.dense_projection.weight\n",
      "    \tmodule.decoder.layers.2.mixer.hyena_proj_conv.short_conv_weight\n",
      "    \tmodule.decoder.layers.1.mixer.mixer.conv_bias\n",
      "    \tmodule.decoder.layers.22.mlp.linear_fc1.layer_norm_weight\n",
      "    \tmodule.decoder.layers.18.mixer.mixer.short_conv.short_conv_weight\n",
      "    \tmodule.decoder.layers.14.mlp.linear_fc1.weight\n",
      "    \tmodule.decoder.layers.12.mixer.dense.weight\n",
      "    \tmodule.decoder.layers.9.mlp.linear_fc2.weight\n",
      "    \tmodule.decoder.layers.7.mlp.linear_fc1.weight\n",
      "    \tmodule.decoder.layers.5.mixer.dense.weight\n",
      "    \tmodule.decoder.layers.2.mlp.linear_fc2.weight\n",
      "    \tmodule.decoder.layers.23.mixer.dense.bias\n",
      "    \tmodule.decoder.layers.21.mixer.dense_projection.weight\n",
      "    \tmodule.decoder.layers.19.mixer.hyena_proj_conv.short_conv_weight\n",
      "    \tmodule.decoder.layers.16.mixer.mixer.conv_bias\n",
      "    \tmodule.decoder.layers.13.mixer.mixer.filter.p\n",
      "    \tmodule.decoder.layers.11.mixer.hyena_proj_conv.short_conv_weight\n",
      "    \tmodule.decoder.layers.9.mixer.mixer.conv_bias\n",
      "    \tmodule.decoder.layers.6.mixer.mixer.filter.p\n",
      "    \tmodule.decoder.layers.4.mixer.hyena_proj_conv.short_conv_weight\n",
      "    \tmodule.decoder.layers.17.self_attention.linear_qkv.weight\n",
      "    \tmodule.decoder.layers.24.self_attention.linear_qkv.weight\n",
      "    \tmodule.decoder.layers.20.mixer.mixer.filter.gamma\n",
      "    \tmodule.decoder.layers.14.mlp.linear_fc1.layer_norm_weight\n",
      "    \tmodule.decoder.layers.12.mixer.dense_projection.weight\n",
      "    \tmodule.decoder.layers.7.mlp.linear_fc1.layer_norm_weight\n",
      "    \tmodule.decoder.layers.5.mixer.dense_projection.weight\n",
      "    \tmodule.decoder.layers.2.mixer.mixer.filter.R\n",
      "    \tmodule.decoder.layers.1.mlp.linear_fc2.weight\n",
      "    \tmodule.decoder.layers.23.mixer.dense_projection.weight\n",
      "    \tmodule.decoder.layers.13.mixer.hyena_proj_conv.short_conv_weight\n",
      "    \tmodule.decoder.layers.10.mlp.linear_fc1.layer_norm_weight\n",
      "    \tmodule.decoder.layers.6.mixer.hyena_proj_conv.short_conv_weight\n",
      "    \tmodule.decoder.layers.3.mlp.linear_fc1.layer_norm_weight\n",
      "    \tmodule.decoder.layers.23.mlp.linear_fc2.weight\n",
      "    \tmodule.decoder.layers.21.mlp.linear_fc1.weight\n",
      "    \tmodule.decoder.layers.19.mixer.dense.weight\n",
      "    \tmodule.decoder.layers.16.mlp.linear_fc2.weight\n",
      "    \tmodule.decoder.layers.16.mixer.dense.bias\n",
      "    \tmodule.decoder.layers.13.mlp.linear_fc1.weight\n",
      "    \tmodule.decoder.layers.6.mlp.linear_fc1.weight\n",
      "    \tmodule.decoder.layers.5.mixer.mixer.filter.h\n",
      "    \tmodule.decoder.layers.2.mixer.mixer.filter.gamma\n",
      "    \tmodule.decoder.layers.1.mlp.linear_fc1.layer_norm_weight\n",
      "    \tmodule.decoder.layers.23.mixer.mixer.conv_bias\n",
      "    \tmodule.decoder.layers.20.mixer.mixer.filter.p\n",
      "    \tmodule.decoder.layers.18.mixer.hyena_proj_conv.short_conv_weight\n",
      "    \tmodule.decoder.layers.14.mlp.linear_fc2.weight\n",
      "    \tmodule.decoder.layers.12.mlp.linear_fc1.layer_norm_weight\n",
      "    \tmodule.decoder.layers.10.self_attention.linear_qkv.layer_norm_weight\n",
      "    \tmodule.decoder.layers.7.mlp.linear_fc2.weight\n",
      "    \tmodule.decoder.layers.5.mlp.linear_fc1.layer_norm_weight\n",
      "    \tmodule.decoder.layers.3.self_attention.linear_qkv.layer_norm_weight\n",
      "    \tmodule.decoder.layers.0.mixer.hyena_proj_conv.short_conv_weight\n",
      "    \tmodule.decoder.layers.21.mlp.linear_fc1.layer_norm_weight\n",
      "    \tmodule.decoder.layers.19.mixer.dense_projection.weight\n",
      "    \tmodule.decoder.layers.15.mlp.linear_fc1.weight\n",
      "    \tmodule.decoder.layers.13.mixer.dense.bias\n",
      "    \tmodule.decoder.layers.11.mixer.dense_projection.weight\n",
      "    \tmodule.decoder.layers.8.mlp.linear_fc1.weight\n",
      "    \tmodule.decoder.layers.6.mixer.dense.bias\n",
      "    \tmodule.decoder.layers.4.mixer.dense_projection.weight\n",
      "    \tmodule.decoder.layers.1.mixer.hyena_proj_conv.short_conv_weight\n",
      "    \tmodule.decoder.layers.24.mlp.linear_fc1.layer_norm_weight\n",
      "    \tmodule.decoder.layers.24.self_attention.linear_proj.bias\n",
      "    \tmodule.decoder.layers.20.mixer.hyena_proj_conv.short_conv_weight\n",
      "    \tmodule.decoder.layers.17.mlp.linear_fc1.layer_norm_weight\n",
      "    \tmodule.decoder.layers.17.self_attention.linear_proj.bias\n",
      "    \tmodule.decoder.layers.14.mixer.dense.weight\n",
      "    \tmodule.decoder.layers.7.mixer.dense.weight\n",
      "    \tmodule.decoder.layers.20.mlp.linear_fc1.weight\n",
      "    \tmodule.decoder.layers.19.mixer.mixer.filter.h\n",
      "    \tmodule.decoder.layers.13.mixer.dense_projection.weight\n",
      "    \tmodule.decoder.layers.6.mixer.dense_projection.weight\n",
      "    \tmodule.decoder.layers.17.self_attention.linear_qkv.layer_norm_weight\n",
      "    \tmodule.decoder.layers.24.self_attention.linear_qkv.layer_norm_weight\n",
      "    \tmodule.decoder.layers.21.mlp.linear_fc2.weight\n",
      "    \tmodule.decoder.layers.19.mlp.linear_fc1.layer_norm_weight\n",
      "    \tmodule.decoder.layers.16.mixer.mixer.filter.R\n",
      "    \tmodule.decoder.layers.13.mlp.linear_fc2.weight\n",
      "    \tmodule.decoder.layers.11.mlp.linear_fc1.weight\n",
      "    \tmodule.decoder.layers.9.mixer.mixer.filter.R\n",
      "    \tmodule.decoder.layers.6.mlp.linear_fc2.weight\n",
      "    \tmodule.decoder.layers.4.mlp.linear_fc1.weight\n",
      "    \tmodule.decoder.layers.22.mlp.linear_fc1.weight\n",
      "    \tmodule.decoder.layers.20.mixer.dense.bias\n",
      "    \tmodule.decoder.layers.18.mixer.dense_projection.weight\n",
      "    \tmodule.decoder.layers.15.mixer.dense_projection.layer_norm_weight\n",
      "    \tmodule.decoder.layers.13.mixer.mixer.conv_bias\n",
      "    \tmodule.decoder.layers.8.mixer.dense_projection.layer_norm_weight\n",
      "    \tmodule.decoder.layers.7.mixer.dense.bias\n",
      "    \tmodule.decoder.layers.0.mlp.linear_fc1.layer_norm_weight\n",
      "[NeMo I 2025-06-18 21:56:38 utils:554] Setting up optimizer with config OptimizerConfig(optimizer='adam', lr=0.0001, min_lr=None, decoupled_lr=None, decoupled_min_lr=None, weight_decay=0.01, fp16=False, bf16=True, params_dtype=torch.bfloat16, use_precision_aware_optimizer=False, store_param_remainders=True, main_grads_dtype=torch.float32, main_params_dtype=torch.float32, exp_avg_dtype=torch.float32, exp_avg_sq_dtype=torch.float32, loss_scale=None, initial_loss_scale=4294967296, min_loss_scale=1.0, loss_scale_window=1000, hysteresis=2, adam_beta1=0.9, adam_beta2=0.95, adam_eps=1e-08, sgd_momentum=0.9, use_distributed_optimizer=True, overlap_param_gather_with_optimizer_step=False, optimizer_cpu_offload=False, optimizer_offload_fraction=0.0, use_torch_optimizer_for_cpu_offload=False, overlap_cpu_optimizer_d2h_h2d=False, pin_cpu_grads=True, pin_cpu_params=True, clip_grad=1.0, log_num_zeros_in_grad=False, barrier_with_L1_time=False, timers=None, config_logger_dir='')\n",
      "[NeMo I 2025-06-18 21:56:38 nemo_logging:393] Doing selective restore from RestoreConfig(path='nemo2_evo2_1b_8k', adapter_path=None, load_model_state=True, load_optim_state=False, load_artifacts=True)\n",
      "[NeMo I 2025-06-18 21:56:38 nemo_logging:393] Using <megatron.core.dist_checkpointing.strategies.fully_parallel.FullyParallelLoadStrategyWrapper object at 0x7f1ef0331f40> dist-ckpt load strategy.\n",
      "[NeMo I 2025-06-18 21:57:00 nemo_logging:393] Global Checkpoint Load : Rank : 0 : Start time : 1750308998.535s : Time spent in load_checkpoint: 22.456s\n",
      "[NeMo I 2025-06-18 21:57:00 nemo_logging:393] Restoring model weights from RestoreConfig(path='nemo2_evo2_1b_8k', adapter_path=None, load_model_state=True, load_optim_state=False, load_artifacts=True)\n",
      "[NeMo I 2025-06-18 21:57:00 nemo_logging:393] Finished restoring from RestoreConfig(path='nemo2_evo2_1b_8k', adapter_path=None, load_model_state=True, load_optim_state=False, load_artifacts=True), cleaning up.\n",
      "┏━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━┓\n",
      "┃\u001b[1;35m \u001b[0m\u001b[1;35m \u001b[0m\u001b[1;35m \u001b[0m┃\u001b[1;35m \u001b[0m\u001b[1;35mName                               \u001b[0m\u001b[1;35m \u001b[0m┃\u001b[1;35m \u001b[0m\u001b[1;35mType                  \u001b[0m\u001b[1;35m \u001b[0m┃\u001b[1;35m \u001b[0m\u001b[1;35mParams\u001b[0m\u001b[1;35m \u001b[0m┃\u001b[1;35m \u001b[0m\u001b[1;35mMode \u001b[0m\u001b[1;35m \u001b[0m┃\n",
      "┡━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━┩\n",
      "│\u001b[2m \u001b[0m\u001b[2m0\u001b[0m\u001b[2m \u001b[0m│ module                              │ DDP                    │  1.1 B │ train │\n",
      "│\u001b[2m \u001b[0m\u001b[2m1\u001b[0m\u001b[2m \u001b[0m│ module.module                       │ Float16Module          │  1.1 B │ train │\n",
      "│\u001b[2m \u001b[0m\u001b[2m2\u001b[0m\u001b[2m \u001b[0m│ module.module.module                │ HyenaModel             │  1.1 B │ train │\n",
      "│\u001b[2m \u001b[0m\u001b[2m3\u001b[0m\u001b[2m \u001b[0m│ module.module.module.embedding      │ LanguageModelEmbedding │  983 K │ train │\n",
      "│\u001b[2m \u001b[0m\u001b[2m4\u001b[0m\u001b[2m \u001b[0m│ module.module.module.rotary_pos_emb │ RotaryEmbedding        │      0 │ train │\n",
      "│\u001b[2m \u001b[0m\u001b[2m5\u001b[0m\u001b[2m \u001b[0m│ module.module.module.decoder        │ HyenaStack             │  1.1 B │ train │\n",
      "│\u001b[2m \u001b[0m\u001b[2m6\u001b[0m\u001b[2m \u001b[0m│ module.module.module.output_layer   │ ColumnParallelLinear   │      0 │ train │\n",
      "└───┴─────────────────────────────────────┴────────────────────────┴────────┴───────┘\n",
      "\u001b[1mTrainable params\u001b[0m: 1.1 B                                                                                                                                        \n",
      "\u001b[1mNon-trainable params\u001b[0m: 0                                                                                                                                        \n",
      "\u001b[1mTotal params\u001b[0m: 1.1 B                                                                                                                                            \n",
      "\u001b[1mTotal estimated model params size (MB)\u001b[0m: 4.4 K                                                                                                                  \n",
      "\u001b[1mModules in train mode\u001b[0m: 356                                                                                                                                     \n",
      "\u001b[1mModules in eval mode\u001b[0m: 0                                                                                                                                        \n",
      "In file included from \u001b[01m\u001b[K/usr/include/python3.12/Python.h:12\u001b[m\u001b[K,\n",
      "                 from \u001b[01m\u001b[K/tmp/tmpccltraq9/main.c:4\u001b[m\u001b[K:\n",
      "\u001b[01m\u001b[K/usr/include/python3.12/pyconfig.h:3:12:\u001b[m\u001b[K \u001b[01;31m\u001b[Kfatal error: \u001b[m\u001b[Kx86_64-linux-gnu/python3.12/pyconfig.h: No such file or directory\n",
      "    3 | #  include \u001b[01;31m\u001b[K<x86_64-linux-gnu/python3.12/pyconfig.h>\u001b[m\u001b[K\n",
      "      |            \u001b[01;31m\u001b[K^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\u001b[m\u001b[K\n",
      "compilation terminated.\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277] WON'T CONVERT filter /usr/local/lib/python3.12/dist-packages/nemo/collections/llm/gpt/model/megatron/hyena/hyena_utils.py line 616 \n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277] due to: \n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277] Traceback (most recent call last):\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/convert_frame.py\", line 1210, in __call__\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     result = self._inner_convert(\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]              ^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/convert_frame.py\", line 597, in __call__\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     return _compile(\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]            ^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/convert_frame.py\", line 1056, in _compile\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     guarded_code = compile_inner(code, one_graph, hooks, transform)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_utils_internal.py\", line 97, in wrapper_function\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     return function(*args, **kwargs)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]            ^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/convert_frame.py\", line 758, in compile_inner\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     return _compile_inner(code, one_graph, hooks, transform)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/convert_frame.py\", line 794, in _compile_inner\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     out_code = transform_code_object(code, transform)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/bytecode_transformation.py\", line 1418, in transform_code_object\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     transformations(instructions, code_options)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/convert_frame.py\", line 256, in _fn\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     return fn(*args, **kwargs)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]            ^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/convert_frame.py\", line 712, in transform\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     tracer.run()\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/symbolic_convert.py\", line 3315, in run\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     super().run()\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/symbolic_convert.py\", line 1216, in run\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     while self.step():\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]           ^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/symbolic_convert.py\", line 1126, in step\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     self.dispatch_table[inst.opcode](self, inst)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/symbolic_convert.py\", line 3511, in RETURN_VALUE\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     self._return(inst)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/symbolic_convert.py\", line 3496, in _return\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     self.output.compile_subgraph(\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/output_graph.py\", line 1141, in compile_subgraph\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     self.compile_and_call_fx_graph(\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/output_graph.py\", line 1434, in compile_and_call_fx_graph\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     compiled_fn = self.call_user_compiler(gm)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/output_graph.py\", line 1484, in call_user_compiler\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     return self._call_user_compiler(gm)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/output_graph.py\", line 1516, in _call_user_compiler\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     compiled_fn = compiler_fn(gm, self.example_inputs())\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/repro/after_dynamo.py\", line 150, in __call__\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     compiled_gm = compiler_fn(gm, example_inputs)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/__init__.py\", line 2349, in __call__\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     return compile_fx(model_, inputs_, config_patches=self.config)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/compile_fx.py\", line 1890, in compile_fx\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     return compile_fx(\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]            ^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/compile_fx.py\", line 2260, in compile_fx\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     raise e.remove_dynamo_frames() from None  # see TORCHDYNAMO_VERBOSE=1\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/compile_fx.py\", line 763, in _compile_fx_inner\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     raise InductorError(e, currentframe()).with_traceback(\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/compile_fx.py\", line 748, in _compile_fx_inner\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     mb_compiled_graph = fx_codegen_and_compile(\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]                         ^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/compile_fx.py\", line 1454, in fx_codegen_and_compile\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     return scheme.codegen_and_compile(gm, example_inputs, inputs_to_check, graph_kwargs)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/compile_fx.py\", line 1174, in codegen_and_compile\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     compiled_fn = graph.compile_to_module().call\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]                   ^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/graph.py\", line 2088, in compile_to_module\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     return self._compile_to_module()\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]            ^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/graph.py\", line 2135, in _compile_to_module\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     mod = PyCodeCache.load_by_key_path(\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/codecache.py\", line 2712, in load_by_key_path\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     mod = _reload_python_module(key, path)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/runtime/compile_tasks.py\", line 36, in _reload_python_module\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     exec(code, mod.__dict__, mod.__dict__)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/tmp/torchinductor_johnsh29/v5/cv5d3thjjjuaajwx3grjifwfqlnnv24ifefi37aymjgb7i3wt2vl.py\", line 80, in <module>\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     async_compile.wait(globals())\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/async_compile.py\", line 424, in wait\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     self._wait_futures(scope)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/async_compile.py\", line 445, in _wait_futures\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     scope[key] = result.result()\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]                  ^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/codecache.py\", line 3189, in result\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     return self.result_fn()\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]            ^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/async_compile.py\", line 325, in get_result\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     kernel.precompile(\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/runtime/triton_heuristics.py\", line 277, in precompile\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     self._make_launchers()\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/runtime/triton_heuristics.py\", line 434, in _make_launchers\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     launchers.append(result.make_launcher())\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]                      ^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/runtime/triton_heuristics.py\", line 1079, in make_launcher\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     binary._init_handles()\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/triton/compiler/compiler.py\", line 384, in _init_handles\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     self.run = driver.active.launcher_cls(self.src, self.metadata)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/triton/backends/nvidia/driver.py\", line 440, in __init__\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     mod = compile_module_from_src(src, \"__triton_launcher\")\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/triton/backends/nvidia/driver.py\", line 57, in compile_module_from_src\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     so = _build(name, src_path, tmpdir, library_dirs(), include_dir, libraries)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/triton/runtime/build.py\", line 50, in _build\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     ret = subprocess.check_call(cc_cmd)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/lib/python3.12/subprocess.py\", line 413, in check_call\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     raise CalledProcessError(retcode, cmd)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277] torch._inductor.exc.InductorError: CalledProcessError: Command '['/home/johnsh29/miniconda3/bin/x86_64-conda-linux-gnu-cc', '/tmp/tmpccltraq9/main.c', '-O3', '-shared', '-fPIC', '-Wno-psabi', '-o', '/tmp/tmpccltraq9/__triton_launcher.cpython-312-x86_64-linux-gnu.so', '-lcuda', '-L/usr/local/lib/python3.12/dist-packages/triton/backends/nvidia/lib', '-L/usr/lib/x86_64-linux-gnu', '-L/usr/local/cuda/compat/lib', '-I/usr/local/lib/python3.12/dist-packages/triton/backends/nvidia/include', '-I/tmp/tmpccltraq9', '-I/usr/include/python3.12']' returned non-zero exit status 1.\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277] \n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277] Set TORCHDYNAMO_VERBOSE=1 for the internal stack trace (please do this especially if you're reporting a bug to PyTorch). For even more developer context, set TORCH_LOGS=\"+dynamo\"\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277] \n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277] Traceback (most recent call last):\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/convert_frame.py\", line 1210, in __call__\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     result = self._inner_convert(\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]              ^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/convert_frame.py\", line 597, in __call__\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     return _compile(\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]            ^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/convert_frame.py\", line 1056, in _compile\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     guarded_code = compile_inner(code, one_graph, hooks, transform)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_utils_internal.py\", line 97, in wrapper_function\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     return function(*args, **kwargs)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]            ^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/convert_frame.py\", line 758, in compile_inner\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     return _compile_inner(code, one_graph, hooks, transform)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/convert_frame.py\", line 794, in _compile_inner\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     out_code = transform_code_object(code, transform)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/bytecode_transformation.py\", line 1418, in transform_code_object\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     transformations(instructions, code_options)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/convert_frame.py\", line 256, in _fn\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     return fn(*args, **kwargs)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]            ^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/convert_frame.py\", line 712, in transform\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     tracer.run()\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/symbolic_convert.py\", line 3315, in run\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     super().run()\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/symbolic_convert.py\", line 1216, in run\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     while self.step():\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]           ^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/symbolic_convert.py\", line 1126, in step\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     self.dispatch_table[inst.opcode](self, inst)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/symbolic_convert.py\", line 3511, in RETURN_VALUE\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     self._return(inst)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/symbolic_convert.py\", line 3496, in _return\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     self.output.compile_subgraph(\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/output_graph.py\", line 1141, in compile_subgraph\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     self.compile_and_call_fx_graph(\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/output_graph.py\", line 1434, in compile_and_call_fx_graph\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     compiled_fn = self.call_user_compiler(gm)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/output_graph.py\", line 1484, in call_user_compiler\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     return self._call_user_compiler(gm)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/output_graph.py\", line 1516, in _call_user_compiler\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     compiled_fn = compiler_fn(gm, self.example_inputs())\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_dynamo/repro/after_dynamo.py\", line 150, in __call__\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     compiled_gm = compiler_fn(gm, example_inputs)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/__init__.py\", line 2349, in __call__\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     return compile_fx(model_, inputs_, config_patches=self.config)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/compile_fx.py\", line 1890, in compile_fx\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     return compile_fx(\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]            ^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/compile_fx.py\", line 2260, in compile_fx\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     raise e.remove_dynamo_frames() from None  # see TORCHDYNAMO_VERBOSE=1\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/compile_fx.py\", line 763, in _compile_fx_inner\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     raise InductorError(e, currentframe()).with_traceback(\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/compile_fx.py\", line 748, in _compile_fx_inner\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     mb_compiled_graph = fx_codegen_and_compile(\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]                         ^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/compile_fx.py\", line 1454, in fx_codegen_and_compile\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     return scheme.codegen_and_compile(gm, example_inputs, inputs_to_check, graph_kwargs)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/compile_fx.py\", line 1174, in codegen_and_compile\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     compiled_fn = graph.compile_to_module().call\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]                   ^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/graph.py\", line 2088, in compile_to_module\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     return self._compile_to_module()\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]            ^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/graph.py\", line 2135, in _compile_to_module\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     mod = PyCodeCache.load_by_key_path(\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/codecache.py\", line 2712, in load_by_key_path\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     mod = _reload_python_module(key, path)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/runtime/compile_tasks.py\", line 36, in _reload_python_module\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     exec(code, mod.__dict__, mod.__dict__)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/tmp/torchinductor_johnsh29/v5/cv5d3thjjjuaajwx3grjifwfqlnnv24ifefi37aymjgb7i3wt2vl.py\", line 80, in <module>\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     async_compile.wait(globals())\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/async_compile.py\", line 424, in wait\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     self._wait_futures(scope)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/async_compile.py\", line 445, in _wait_futures\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     scope[key] = result.result()\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]                  ^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/codecache.py\", line 3189, in result\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     return self.result_fn()\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]            ^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/async_compile.py\", line 325, in get_result\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     kernel.precompile(\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/runtime/triton_heuristics.py\", line 277, in precompile\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     self._make_launchers()\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/runtime/triton_heuristics.py\", line 434, in _make_launchers\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     launchers.append(result.make_launcher())\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]                      ^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/torch/_inductor/runtime/triton_heuristics.py\", line 1079, in make_launcher\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     binary._init_handles()\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/triton/compiler/compiler.py\", line 384, in _init_handles\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     self.run = driver.active.launcher_cls(self.src, self.metadata)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/triton/backends/nvidia/driver.py\", line 440, in __init__\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     mod = compile_module_from_src(src, \"__triton_launcher\")\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/triton/backends/nvidia/driver.py\", line 57, in compile_module_from_src\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     so = _build(name, src_path, tmpdir, library_dirs(), include_dir, libraries)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/local/lib/python3.12/dist-packages/triton/runtime/build.py\", line 50, in _build\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     ret = subprocess.check_call(cc_cmd)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]   File \"/usr/lib/python3.12/subprocess.py\", line 413, in check_call\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277]     raise CalledProcessError(retcode, cmd)\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277] torch._inductor.exc.InductorError: CalledProcessError: Command '['/home/johnsh29/miniconda3/bin/x86_64-conda-linux-gnu-cc', '/tmp/tmpccltraq9/main.c', '-O3', '-shared', '-fPIC', '-Wno-psabi', '-o', '/tmp/tmpccltraq9/__triton_launcher.cpython-312-x86_64-linux-gnu.so', '-lcuda', '-L/usr/local/lib/python3.12/dist-packages/triton/backends/nvidia/lib', '-L/usr/lib/x86_64-linux-gnu', '-L/usr/local/cuda/compat/lib', '-I/usr/local/lib/python3.12/dist-packages/triton/backends/nvidia/include', '-I/tmp/tmpccltraq9', '-I/usr/include/python3.12']' returned non-zero exit status 1.\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277] \n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277] Set TORCHDYNAMO_VERBOSE=1 for the internal stack trace (please do this especially if you're reporting a bug to PyTorch). For even more developer context, set TORCH_LOGS=\"+dynamo\"\n",
      "[rank0]:W0618 21:57:02.561000 1489278 torch/_dynamo/convert_frame.py:1277] \n",
      "[WARNING  | DotProductAttention]: flash-attn v3 may provide important feature support or performance improvement. Please install flash-attn v3 by \n",
      "(1) git clone https://github.com/Dao-AILab/flash-attention.git\n",
      "(2) cd flash-attention/ && git checkout 27f501d && cd hopper/ && python setup.py install\n",
      "(3) python_path=`python -c \"import site; print(site.getsitepackages()[0])\"`\n",
      "(4) mkdir -p $python_path/flash_attn_3\n",
      "(5) wget -P $python_path/flash_attn_3 https://raw.githubusercontent.com/Dao-AILab/flash-attention/27f501dbe011f4371bff938fe7e09311ab3002fa/hopper/flash_attn_interface.py\n",
      "WARNING:DotProductAttention:flash-attn v3 may provide important feature support or performance improvement. Please install flash-attn v3 by \n",
      "(1) git clone https://github.com/Dao-AILab/flash-attention.git\n",
      "(2) cd flash-attention/ && git checkout 27f501d && cd hopper/ && python setup.py install\n",
      "(3) python_path=`python -c \"import site; print(site.getsitepackages()[0])\"`\n",
      "(4) mkdir -p $python_path/flash_attn_3\n",
      "(5) wget -P $python_path/flash_attn_3 https://raw.githubusercontent.com/Dao-AILab/flash-attention/27f501dbe011f4371bff938fe7e09311ab3002fa/hopper/flash_attn_interface.py\n",
      "[NeMo W 2025-06-18 21:57:03 rerun_state_machine:1264] Implicit initialization of Rerun State Machine!\n",
      "[NeMo W 2025-06-18 21:57:03 rerun_state_machine:239] RerunStateMachine initialized in mode RerunMode.DISABLED\n",
      "Training epoch 0, iteration 0/9 | lr: 0 | global_batch_size: 1 | global_step: 0 | reduced_train_loss: 1.371 | train_step_timing in s: 2.193\n",
      "Training epoch 0, iteration 1/9 | lr: 2e-05 | global_batch_size: 1 | global_step: 1 | reduced_train_loss: 1.37 | train_step_timing in s: 0.3513 | consumed_samples: 2\n",
      "Training epoch 0, iteration 2/9 | lr: 4e-05 | global_batch_size: 1 | global_step: 2 | reduced_train_loss: 1.259 | train_step_timing in s: 0.3506 | consumed_samples: 3\n",
      "Training epoch 0, iteration 3/9 | lr: 6e-05 | global_batch_size: 1 | global_step: 3 | reduced_train_loss: 1.277 | train_step_timing in s: 0.3502 | consumed_samples: 4\n",
      "Training epoch 0, iteration 4/9 | lr: 8e-05 | global_batch_size: 1 | global_step: 4 | reduced_train_loss: 1.257 | train_step_timing in s: 0.3505 | consumed_samples: 5\n",
      "Epoch 0, global step 4: 'val_loss' was not in top 5\n",
      "[NeMo I 2025-06-18 21:57:04 nemo_logging:393] Using FullyParallelSaveStrategyWrapper(torch_dist, 1) dist-ckpt save strategy.\n",
      "[NeMo I 2025-06-18 21:57:05 nemo_logging:393] Global Checkpoint Save : Rank: 0 : Iteration: 4 : Start time: 1750309024.990s : Save duration: 0.217s\n",
      "[NeMo I 2025-06-18 21:57:12 nemo_logging:393] Scheduled async checkpoint save for /home/johnsh29/Evo2_Mortierellaceae/pretraining_mortierellaceae/evo2/checkpoints/evo2--val_loss=0.0000-epoch=0-consumed_samples=5.0-last.ckpt\n",
      "[NeMo I 2025-06-18 21:57:12 nemo_logging:393] Async finalization time took 0.002 s\n",
      "Validation: iteration 1/20\n",
      "Validation: iteration 2/20\n",
      "Validation: iteration 3/20\n",
      "Validation: iteration 4/20\n",
      "Validation: iteration 5/20\n",
      "Validation: iteration 6/20\n",
      "Validation: iteration 7/20\n",
      "Validation: iteration 8/20\n",
      "Validation: iteration 9/20\n",
      "Validation: iteration 10/20\n",
      "Validation: iteration 11/20\n",
      "Validation: iteration 12/20\n",
      "Validation: iteration 13/20\n",
      "Validation: iteration 14/20\n",
      "Validation: iteration 15/20\n",
      "Validation: iteration 16/20\n",
      "Validation: iteration 17/20\n",
      "Validation: iteration 18/20\n",
      "Validation: iteration 19/20\n",
      "Validation: iteration 20/20\n",
      "[NeMo W 2025-06-18 21:57:14 nemo_logging:405] /usr/local/lib/python3.12/dist-packages/lightning/pytorch/trainer/connectors/logger_connector/result.py:431: It is recommended to use `self.log('global_batch_size', ..., sync_dist=True)` when logging on epoch level in distributed setting to accumulate the metric across devices.\n",
      "    \n",
      "[NeMo W 2025-06-18 21:57:14 nemo_logging:405] /usr/local/lib/python3.12/dist-packages/lightning/pytorch/trainer/connectors/logger_connector/result.py:431: It is recommended to use `self.log('val_loss', ..., sync_dist=True)` when logging on epoch level in distributed setting to accumulate the metric across devices.\n",
      "    \n",
      "Training epoch 0, iteration 5/9 | lr: 0.0001 | global_batch_size: 1 | global_step: 5 | reduced_train_loss: 1.26 | train_step_timing in s: 0.3964 | consumed_samples: 6 | val_loss: 1.264\n",
      "[NeMo I 2025-06-18 21:57:15 nemo_logging:393] Async finalization time took 0.000 s\n",
      "Training epoch 0, iteration 6/9 | lr: 3e-05 | global_batch_size: 1 | global_step: 6 | reduced_train_loss: 1.323 | train_step_timing in s: 0.4149 | consumed_samples: 7 | val_loss: 1.264\n",
      "[NeMo I 2025-06-18 21:57:15 nemo_logging:393] Async finalization time took 0.000 s\n",
      "Training epoch 0, iteration 7/9 | lr: 3e-05 | global_batch_size: 1 | global_step: 7 | reduced_train_loss: 1.338 | train_step_timing in s: 0.399 | consumed_samples: 8 | val_loss: 1.264\n",
      "[NeMo I 2025-06-18 21:57:16 nemo_logging:393] Async finalization time took 0.000 s\n",
      "Training epoch 0, iteration 8/9 | lr: 3e-05 | global_batch_size: 1 | global_step: 8 | reduced_train_loss: 1.257 | train_step_timing in s: 0.4168 | consumed_samples: 9 | val_loss: 1.264\n",
      "[NeMo I 2025-06-18 21:57:16 nemo_logging:393] Async finalization time took 0.000 s\n",
      "Training epoch 0, iteration 9/9 | lr: 3e-05 | global_batch_size: 1 | global_step: 9 | reduced_train_loss: 1.292 | train_step_timing in s: 0.4083 | consumed_samples: 10 | val_loss: 1.264\n",
      "Epoch 0, global step 9: 'val_loss' reached 1.26396 (best 1.26396), saving model to '/home/johnsh29/Evo2_Mortierellaceae/pretraining_mortierellaceae/evo2/checkpoints/evo2--val_loss=1.2640-epoch=0-consumed_samples=10.0.ckpt' as top 5\n",
      "[NeMo I 2025-06-18 21:57:20 nemo_logging:393] Global Checkpoint Save : Rank: 0 : Iteration: 9 : Start time: 1750309039.748s : Save duration: 0.476s\n",
      "[NeMo I 2025-06-18 21:57:20 nemo_logging:393] Scheduled async checkpoint save for /home/johnsh29/Evo2_Mortierellaceae/pretraining_mortierellaceae/evo2/checkpoints/evo2--val_loss=1.2640-epoch=0-consumed_samples=10.0.ckpt\n",
      "[NeMo I 2025-06-18 21:57:23 nemo_logging:393] Global Checkpoint Save : Rank: 0 : Iteration: 9 : Start time: 1750309040.832s : Save duration: 2.746s\n",
      "[NeMo I 2025-06-18 21:57:35 nemo_logging:393] Scheduled async checkpoint save for /home/johnsh29/Evo2_Mortierellaceae/pretraining_mortierellaceae/evo2/checkpoints/evo2--val_loss=1.2640-epoch=0-consumed_samples=10.0-last.ckpt\n",
      "[NeMo I 2025-06-18 21:57:35 nemo_logging:393] Async finalization time took 0.001 s\n",
      "Validation: iteration 1/20\n",
      "Validation: iteration 2/20\n",
      "Validation: iteration 3/20\n",
      "Validation: iteration 4/20\n",
      "Validation: iteration 5/20\n",
      "Validation: iteration 6/20\n",
      "Validation: iteration 7/20\n",
      "Validation: iteration 8/20\n",
      "Validation: iteration 9/20\n",
      "Validation: iteration 10/20\n",
      "Validation: iteration 11/20\n",
      "Validation: iteration 12/20\n",
      "Validation: iteration 13/20\n",
      "Validation: iteration 14/20\n",
      "Validation: iteration 15/20\n",
      "Validation: iteration 16/20\n",
      "Validation: iteration 17/20\n",
      "Validation: iteration 18/20\n",
      "Validation: iteration 19/20\n",
      "Validation: iteration 20/20\n",
      "[NeMo I 2025-06-18 21:58:10 nemo_logging:393] Async finalization time took 0.000 s\n",
      "`Trainer.fit` stopped: `max_steps=10` reached.\n",
      "[NeMo I 2025-06-18 21:58:10 nemo_logging:393] Pending async checkpoint saves. Finalizing them synchronously now\n",
      "[NeMo I 2025-06-18 22:03:04 nemo_logging:393] Successfully saved checkpoint from iteration       4 to /home/johnsh29/Evo2_Mortierellaceae/pretraining_mortierellaceae/evo2/checkpoints/evo2--val_loss=0.0000-epoch=0-consumed_samples=5.0-last.ckpt\n",
      "[NeMo I 2025-06-18 22:03:05 nemo_logging:393] Async checkpoint save for step 5 (/home/johnsh29/Evo2_Mortierellaceae/pretraining_mortierellaceae/evo2/checkpoints/evo2--val_loss=0.0000-epoch=0-consumed_samples=5.0-last.ckpt) finalized successfully.\n",
      "[NeMo I 2025-06-18 22:03:27 nemo_logging:393] Successfully saved checkpoint from iteration       9 to /home/johnsh29/Evo2_Mortierellaceae/pretraining_mortierellaceae/evo2/checkpoints/evo2--val_loss=1.2640-epoch=0-consumed_samples=10.0.ckpt\n",
      "[NeMo I 2025-06-18 22:03:28 nemo_logging:393] Async checkpoint save for step 10 (/home/johnsh29/Evo2_Mortierellaceae/pretraining_mortierellaceae/evo2/checkpoints/evo2--val_loss=1.2640-epoch=0-consumed_samples=10.0.ckpt) finalized successfully.\n",
      "[NeMo I 2025-06-18 22:03:55 nemo_logging:393] Successfully saved checkpoint from iteration       9 to /home/johnsh29/Evo2_Mortierellaceae/pretraining_mortierellaceae/evo2/checkpoints/evo2--val_loss=1.2640-epoch=0-consumed_samples=10.0-last.ckpt\n",
      "[NeMo I 2025-06-18 22:03:55 nemo_logging:393] Async checkpoint save for step 10 (/home/johnsh29/Evo2_Mortierellaceae/pretraining_mortierellaceae/evo2/checkpoints/evo2--val_loss=1.2640-epoch=0-consumed_samples=10.0-last.ckpt) finalized successfully.\n",
      "[NeMo I 2025-06-18 22:03:55 nemo_logging:393] Async finalization time took 344.980 s\n",
      "\n",
      "Training completed!\n",
      "Total training time: 461.33 seconds\n",
      "(7.69 minutes)\n",
      "(0.13 hours)\n"
     ]
    }
   ],
   "source": [
    "import time\n",
    "\n",
    "# Start timer\n",
    "start_time = time.time()\n",
    "\n",
    "\n",
    "\n",
    "# For evo2 training and fine-tuning follow the same set of steps, so we use the same train_evo2 command.\n",
    "#  the big difference is the --ckpt-dir argument which points to a pre-existing checkpoint from some other training run.\n",
    "!train_evo2 \\\n",
    "    -d training_data_config.yaml \\\n",
    "    --dataset-dir {preprocessed_data} \\\n",
    "    --result-dir pretraining_mortierellaceae \\\n",
    "    --model-size 1b \\\n",
    "    --devices 1 \\\n",
    "    --num-nodes 1 \\\n",
    "    --seq-length 8192 \\\n",
    "    --micro-batch-size 1 \\\n",
    "    --lr 0.0001 \\\n",
    "    --warmup-steps 5 \\\n",
    "    --max-steps 10 \\\n",
    "    --tensor-parallel-size 1 \\\n",
    "    --ckpt-dir nemo2_evo2_1b_8k \\\n",
    "    --clip-grad 1 \\\n",
    "    --wd 0.01 \\\n",
    "    --activation-checkpoint-recompute-num-layers 1 \\\n",
    "    --val-check-interval 5 \\\n",
    "    --ckpt-async-save \\\n",
    "    --wandb-offline\n",
    "\n",
    "\n",
    "\n",
    "# End timer and calculate duration\n",
    "end_time = time.time()\n",
    "training_duration = end_time - start_time\n",
    "\n",
    "# Print timing results\n",
    "print(\"\\nTraining completed!\")\n",
    "print(f\"Total training time: {training_duration:.2f} seconds\")\n",
    "print(f\"({training_duration/60:.2f} minutes)\")\n",
    "print(f\"({training_duration/3600:.2f} hours)\")"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "2dee8fab-990a-47f4-a8a8-3d6ce2fd7644",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "192c3a1f-bca2-4748-a77d-5807ebca04db",
   "metadata": {},
   "outputs": [],
   "source": []
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "3b0e97b5-d396-4243-8ddc-552d0879edc0",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.13.2"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
